const rootLayout=document.getElementById("root"),endpoint=rootLayout.getAttribute("dev")?"http://localhost:8080":"https://pretty.nasuyun.com",clearIcon=`<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-arrow-counterclockwise" viewBox="0 0 16 16">
<path fill-rule="evenodd" d="M8 3a5 5 0 1 1-4.546 2.914.5.5 0 0 0-.908-.417A6 6 0 1 0 8 2v1z"/>
<path d="M8 4.466V.534a.25.25 0 0 0-.41-.192L5.23 2.308a.25.25 0 0 0 0 .384l2.36 1.966A.25.25 0 0 0 8 4.466z"/>
</svg>`,emptyPageHtml=`
<div class="hits-empty-state" style="min-width:600px">
  <svg
    xmlns="http://www.w3.org/2000/svg"
    xmlns:xlink="http://www.w3.org/1999/xlink"
    width="138"
    height="138"
    class="hits-empty-state-image"
  >
    <defs>
      <linearGradient id="c" x1="50%" x2="50%" y1="100%" y2="0%">
        <stop offset="0%" stop-color="#F5F5FA" />
        <stop offset="100%" stop-color="#FFF" />
      </linearGradient>
      <path
        id="b"
        d="M68.71 114.25a45.54 45.54 0 1 1 0-91.08 45.54 45.54 0 0 1 0 91.08z"
      />
      <filter
        id="a"
        width="140.6%"
        height="140.6%"
        x="-20.3%"
        y="-15.9%"
        filterUnits="objectBoundingBox"
      >
        <feOffset dy="4" in="SourceAlpha" result="shadowOffsetOuter1" />
        <feGaussianBlur
          in="shadowOffsetOuter1"
          result="shadowBlurOuter1"
          stdDeviation="5.5"
        />
        <feColorMatrix
          in="shadowBlurOuter1"
          result="shadowMatrixOuter1"
          values="0 0 0 0 0.145098039 0 0 0 0 0.17254902 0 0 0 0 0.380392157 0 0 0 0.15 0"
        />
        <feOffset dy="2" in="SourceAlpha" result="shadowOffsetOuter2" />
        <feGaussianBlur
          in="shadowOffsetOuter2"
          result="shadowBlurOuter2"
          stdDeviation="1.5"
        />
        <feColorMatrix
          in="shadowBlurOuter2"
          result="shadowMatrixOuter2"
          values="0 0 0 0 0.364705882 0 0 0 0 0.392156863 0 0 0 0 0.580392157 0 0 0 0.2 0"
        />
        <feMerge>
          <feMergeNode in="shadowMatrixOuter1" />
          <feMergeNode in="shadowMatrixOuter2" />
        </feMerge>
      </filter>
    </defs>
    <g fill="none" fill-rule="evenodd">
      <circle
        cx="68.85"
        cy="68.85"
        r="68.85"
        fill="#5468FF"
        opacity=".07"
      />
      <circle
        cx="68.85"
        cy="68.85"
        r="52.95"
        fill="#5468FF"
        opacity=".08"
      />
      <use fill="#000" filter="url(#a)" xlink:href="#b" />
      <use fill="url(#c)" xlink:href="#b" />
      <path
        d="M76.01 75.44c5-5 5.03-13.06.07-18.01a12.73 12.73 0 0 0-18 .07c-5 4.99-5.03 13.05-.07 18a12.73 12.73 0 0 0 18-.06zm2.5 2.5a16.28 16.28 0 0 1-23.02.09A16.29 16.29 0 0 1 55.57 55a16.28 16.28 0 0 1 23.03-.1 16.28 16.28 0 0 1-.08 23.04zm1.08-1.08l-2.15 2.16 8.6 8.6 2.16-2.15-8.6-8.6z"
        fill="#5369FF"
      />
    </g>
  </svg>

  <p class="hits-empty-state-title">
    抱歉，无法找到结果。
  </p>
  <p class="hits-empty-state-description">
    请调整过滤项或查询关键词
  </p>
</div>
`,fieldRender={icons:{star:'<i class="fa fa-star" style="color:#FFAE2C;margin-right:0.2rem"></i>',smile:'<i class="fa-solid fa-face-smile" style="color:#FFAE2C;margin-right:0.2rem"></i>',heart:'<i class="fa-solid fa-heart" style="color:#F95018;margin-right:0.2rem"></i>',thumbs:'<i class="fa-solid fa-thumbs-up" style="color:#FFAE2C;margin-right:0.2rem"></i>'},isNumber:function(e){return"string"==typeof e&&!isNaN(e)&&!isNaN(parseFloat(e))},getSubstring:function(e,t){return e.substring(0,t)},getBracketValue:function(e){return/\(([^()]+)\)/g.exec(e)[1]},getFieldValue:function(e,t){if(!e||"string"!=typeof e)return"";{let i=e.split(".").reduce((e,t)=>e&&"undefined"!==e[t]?e[t]:"",t);return i&&i+""||""}},value:function(e,t){let i=e.indexOf("(");if(i>0){let a=e.substring(0,i).trim();return this[a]&&this[a](e,t)}{let r=this.getFieldValue(e,t);return r}},highlight:function(e,t){let i=this.getBracketValue(e).split(",").map(e=>e.trim()),a=i[0],r=t._highlightResult&&t._highlightResult[a]?.value||this.getFieldValue(a,t),s=i[1];return s&&this.getSubstring(r,s)||r},substring:function(e,t){let i=this.getBracketValue(e).split(",").map(e=>e.trim()),a=i[0],r=i[1],s=this.getFieldValue(a,t);return len=r&&r||120,this.getSubstring(s,len)},replace:function(e,t){let i=this.getBracketValue(e).split(",").map(e=>e.trim()),a=i[0],r=i[1],s=i[2],n=this.getFieldValue(a,t);return n.replace(RegExp(r,"ig"),s)},repeat:function(e,t){let i=this.getBracketValue(e).split(",").map(e=>e.trim()),a=i[0],r=this.getFieldValue(a,t),s=i[1];return(s=this.icons[s]||s).repeat(r)},format:function(e,t){let i=this.getBracketValue(e).split(",").map(e=>e.trim()),a=i[0],r=i[1],s=this.getFieldValue(a,t);return moment(s,this.isNumber(s)&&"x").format(r)},image:function(e,t){let i=this.getBracketValue(e).split(",").map(e=>e.trim()),a=i[0],r=i[1],s=this.getFieldValue(a,t);return`<img src=${s} ${r}/>`}},create=e=>{var t=document.createElement(e.type||"div");return e.class&&(t.className=e.class),e.innerHTML&&(t.innerHTML=e.innerHTML),e.src&&(t.src=e.src),e.id&&t.setAttribute("id",e.id),t},createFilterContainer=()=>{let e=create({type:"div",class:"container-filters"}),t=create({type:"div",id:"clear-filters"}),i=create({type:"div",class:"container-header"}),a=create({innerHTML:`<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="#000" class="bi bi-filter" viewBox="0 0 16 16">
        <path d="M6 10.5a.5.5 0 0 1 .5-.5h3a.5.5 0 0 1 0 1h-3a.5.5 0 0 1-.5-.5zm-2-3a.5.5 0 0 1 .5-.5h7a.5.5 0 0 1 0 1h-7a.5.5 0 0 1-.5-.5zm-2-3a.5.5 0 0 1 .5-.5h11a.5.5 0 0 1 0 1h-11a.5.5 0 0 1-.5-.5z"/>
      </svg>`}),r=create({type:"div",id:"facets",class:"container-body"});i.appendChild(a),i.appendChild(t),e.appendChild(i),e.appendChild(r),document.getElementById("facets-container").appendChild(e)},renderCanvas=e=>{let t=e.searchSettings,i=e.index,a=document.getElementById("right-header-container");(t?.sortAttributes?.length>0||t?.pagination?.enabled)&&(a.className="container-header container-options");let r=[],s;if(t?.sortAttributes?.length>0){s={default:{field:"_score",order:"desc"}};let n=t.sortAttributes.reduce((e,t)=>({...e,[`_${t.field}_desc`]:{field:t.field,order:"desc"},[`_${t.field}_asc`]:{field:t.field,order:"asc"}}),{});s={...s,...n},t.sortAttributes.map(e=>{let t="_sortby_"+e.field;a.appendChild(create({id:t,class:"container-option"})),r.push(instantsearch.widgets.sortBy({container:"#"+t,items:[{label:e.title,value:i},{label:"从高到低",value:[i,e.field,"desc"].join("_")},{label:"从低到高",value:[i,e.field,"asc"].join("_")},]}))})}let l=[],o={1:{min:8,middle:16,max:32},2:{min:12,middle:24,max:48},3:{min:12,middle:24,max:48},4:{min:16,middle:32,max:64}},d=e?.styles?.gridMaxColumns&&o[e?.styles?.gridMaxColumns+""]||o["4"];if(t?.pagination?.enabled){let c=create({id:"hits-per-page",class:"container-option"});a.appendChild(c);let u=[{label:`每页${d.min}条`,value:d.min,default:!0},{label:`每页${d.middle}条`,value:d.middle},{label:`每页${d.max}条`,value:d.max},];l.push(instantsearch.widgets.hitsPerPage({container:"#hits-per-page",items:u}))}let h=[];var g=[];if(t.facetAttributes&&t.facetAttributes.length>0){createFilterContainer(),g=t.facetAttributes.map(e=>({...e})),t={...t,facet_attributes:g};let $=document.getElementById("facets");$.classList.add("container-wrapper"),t.facet_attributes?.map(e=>{var t=create({type:"div",class:"ais-Panel ais-Panel--collapsible"}),i=create({type:"div",class:"ais-Panel-header"}),a=create({type:"span",innerHTML:e.title});i.appendChild(a);let r=e.id;var s=create({type:"div",class:"ais-Panel-body",id:r});t.appendChild(i),t.appendChild(s),$.appendChild(t);try{switch(e.widget){case"menu":h.push(instantsearch.widgets.menu({container:"#"+r,attribute:e.attribute,...e.config}));break;case"menuSelect":h.push(instantsearch.widgets.menuSelect({container:"#"+r,attribute:e.attribute,...e.config,templates:{defaultOption:(e,{html:t})=>t`<span>所有的</span>`}}));break;case"numericMenu":try{let n=JSON.parse(e.config.json);h.push(instantsearch.widgets.numericMenu({container:"#"+r,attribute:e.attribute,items:n}))}catch(l){console.error(l)}break;case"rangeSlider":h.push(instantsearch.widgets.rangeSlider({container:"#"+r,attribute:e.attribute,pips:!1,tooltips:!0,...e.config}));break;case"ratingMenu":h.push(instantsearch.widgets.ratingMenu({container:"#"+r,attribute:e.attribute,...e.config}));break;case"rangeInput":h.push(instantsearch.widgets.rangeInput({container:"#"+r,attribute:e.attribute,...e.config}));break;case"toggleRefinement":h.push(instantsearch.widgets.toggleRefinement({container:"#"+r,attribute:e.attribute,...e.config,templates:{labelText:({data:t},{html:i})=>i`<span>${e?.config?.label}</span>`}}));break;default:h.push(instantsearch.widgets.refinementList({container:"#"+r,attribute:e.attribute,...e.config,templates:{showMoreText:`
                                  {{#isShowingMore}}
                                    收紧
                                  {{/isShowingMore}}
                                  {{^isShowingMore}}
                                    更多
                                  {{/isShowingMore}}
                                  `,searchableNoResults:(e,{html:t})=>t`<span>无结果</span>`}}))}}catch(o){console.log(o)}}),h.push(instantsearch.widgets.clearRefinements({container:"#clear-filters",templates:{resetLabel:({hasRefinements:e},{html:t})=>e?clearIcon:""}}))}let p=(e,t)=>{let i=/{{\s*(.*)\s*}}/g;return e.replaceAll(i,function(e,i,a){return t(i)})},m=`
    <table class="table table-striped table-hover table-responsive">
      <thead>
        <tr>
          <th>Part Number</th>
          <th>Description</th>
          <th>Available Quantity</th>
        </tr>
      </thead>
      <tbody>
      {{#hits}}
        <tr>
          <td style="white-space:nowrap"><a href="{{ url }}">{{ code }}</a></td>
          <td>{{ description }}</td>
          <td>{{ quantityAvailable }}</td>
        </tr>
      {{/hits}}
      </tbody>
    </table>
  `;function f(e){return m}let y=new Searchkit({connection:{host:endpoint,apiKey:e.apikey},search_settings:{...t,sorting:s}}),b=instantsearch({indexName:i,searchClient:SearchkitInstantsearchClient(y)}),_=(e,t)=>p(e,e=>{try{return e&&fieldRender.value(e.trim(),t)||""}catch(i){return console.error(i),e}}),w=e?.styles?.layout=="table"?instantsearch.connectors.connectHits(function(t){let i=t.hits;console.log("hits?.length:",i?.length),console.log("opts:",t);let a=e?.styles?.columns?.map(e=>`<th ${e.width&&"width="+e.width}>${e.label}</th>`).join(""),r=`<thead><tr>${a}</tr></thead>`,s=i.map(t=>`<tr>${e?.styles?.columns?.map(e=>`<td>${_(e.html,t)}</td>`).join("")}</tr>`),n=document.createElement("table");n.className="styled-table",n.innerHTML=r+s.join("");let l=document.querySelector("#hits");l.innerHTML="",t?.results&&e?.styles?.columns?.length>0&&(i.length>0?(l.appendChild(n),document.querySelector("#container").style="max-width: max-content"):l.appendChild(create({innerHTML:emptyPageHtml})))})():instantsearch.widgets.hits({container:"#hits",templates:{item:(t,{html:i,components:a})=>i`${_(e?.styles?.hitHtml,t)}`,empty:e=>(e.getRefinements().length,emptyPageHtml)}});b.addWidgets([instantsearch.widgets.searchBox({container:"#searchbox",...e?.styles?.searchbox}),...h,...r,...l,w,instantsearch.widgets.pagination({container:"#pagination"})]),b.start()},fr=(e,t)=>{for(var i="",a=0;a<Math.min(e,t);a++)i+="1fr ";return i},renderStyle=e=>{let t="",i=document.createElement("style");if(e?.styles?.primaryColor){let a=`
            .header {
                background: ${e?.styles?.primaryColor}
            }
            .header_simple {
                background: ${e?.styles?.primaryColor}
            }            
            .ais-Pagination-item--selected {
                background-color: ${e?.styles?.primaryColor}
            }
            .ais-RangeSlider .rheostat-progress {
                background-color: ${e?.styles?.primaryColor}
            }
            .ais-RefinementList-item--selected .ais-RefinementList-checkbox {
                background-color: ${e?.styles?.primaryColor}
            }
            .ais-RatingMenu-starIcon--full {
                background-color: ${e?.styles?.primaryColor}
            }
            .ais-ToggleRefinement-checkbox:checked {
                background-color: ${e?.styles?.primaryColor}
            }
            `;t+=a}if(e?.styles?.gridMaxColumns){let r=`
                @media (min-width: 680px) {
                    .ais-Hits-list {
                    grid-template-columns: ${fr(e?.styles?.gridMaxColumns,2)};
                    }
                }
                @media (min-width: 900px) {
                    .ais-Hits-list {
                        grid-template-columns: ${fr(e?.styles?.gridMaxColumns,3)};
                    }
                }
                @media (min-width: 1200px) {
                    .ais-Hits-list {
                        grid-template-columns: ${fr(e?.styles?.gridMaxColumns,4)};
                    }
                }            
                `;t+=r}if(e?.styles?.gridBorder){let s=`
                .ais-Hits {
                    box-shadow: ${e.styles.gridBorder};
                    ${"none"!=e.styles.gridBorder&&"padding: 24px;"}  
                }
                `;t+=s}if(e?.styles?.banner){if(e?.styles?.banner?.background){if(e.styles.banner.background.startsWith("http")){let n=`
                .header {
                    background-image: url(${e?.styles?.banner?.background});
                    background-size: cover;
                }
                `;t+=n}else if("standard"==e.styles.banner.background){document.getElementById("header").classList.add("header_"+e.styles.banner.background);let l=` 
                .container-header {
                    min-height: 40px;
                }
                .container-options {
                    padding: 0;
                }
                `;t+=l}else if("min"==e.styles.banner.background){document.getElementById("header").classList.add("header_min");let o=` 
                .container-header {
                    min-height: 40px;
                }
                .container-options {
                    padding: 0;
                }
                .container {
                    padding: 1rem 1rem;
                }`;t+=o}}if(e?.styles?.banner?.slogan_text){let d=document.getElementById("header-title");d.innerHTML=e?.styles?.banner?.slogan_text,e?.styles?.banner?.slogan_color&&(d.style.color=e?.styles?.banner?.slogan_color)}if(e?.styles?.banner?.logo){let c=document.getElementById("header-logo"),u=document.createElement("img");u.src=e?.styles?.banner?.logo,u.style="max-height:64",c.appendChild(u)}}t&&(i.innerHTML=t,document.head.appendChild(i))},renderByConfig=()=>{let e=rootLayout.getAttribute("apikey");"undefined"!=e&&fetch(endpoint+"/api/component",{headers:{apikey:e}}).then(e=>e.json()).then(e=>{renderCanvas(e),renderStyle(e),rootLayout.style.display=""}).catch(e=>rootLayout.appendChild(create({innerHTML:"加载失败"+e})))};renderByConfig();